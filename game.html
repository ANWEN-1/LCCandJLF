<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœºå™¨ç‹—å¤§å†’é™©</title>
    <style>
        body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; flex-direction: column; }
        
        /* æ¸¸æˆå®¹å™¨ */
        #game-container {
            position: relative;
            width: 800px;
            height: 400px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 4px solid #333;
        }

        /* ç”»å¸ƒ */
        canvas { display: block; width: 100%; height: 100%; }

        /* UI ç•Œé¢ */
        .ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(255,255,255,0.8);
            z-index: 10;
        }

        h1 { margin: 0 0 20px 0; font-size: 40px; color: #333; }
        p { font-size: 18px; color: #666; margin-bottom: 30px; }

        .btn-start {
            padding: 15px 40px;
            font-size: 20px;
            background: #FF7F50;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 5px 15px rgba(255, 127, 80, 0.4);
        }
        .btn-start:hover { transform: scale(1.1); }

        .score-board {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            z-index: 5;
        }

        .back-btn {
            position: absolute;
            top: 20px; left: 20px;
            text-decoration: none;
            color: #333;
            font-weight: bold;
            z-index: 20;
            background: rgba(255,255,255,0.8);
            padding: 5px 15px;
            border-radius: 20px;
        }

        /* === é»‘å¤œæ¨¡å¼é€‚é… === */
        body.dark-mode { background-color: #1a2340; }
        body.dark-mode #game-container { background-color: #2b324d; border-color: #555; }
        body.dark-mode .ui-layer { background: rgba(43, 50, 77, 0.9); }
        body.dark-mode h1 { color: white; }
        body.dark-mode p { color: #ccc; }
        body.dark-mode .score-board { color: white; }
    </style>
</head>
<body>

    <a href="index.html" class="back-btn">â† é€€å‡ºæ¸¸æˆ</a>

    <div id="game-container">
        <div class="score-board">å¾—åˆ†: <span id="score">0</span></div>
        
        <div id="menu" class="ui-layer">
            <h1>ğŸ• æœºå™¨ç‹—å¤§å†’é™©</h1>
            <p>æŒ‰ä¸‹ <b>ç©ºæ ¼é”®</b> æˆ– <b>ç‚¹å‡»å±å¹•</b> è·³è·ƒèº²é¿éšœç¢ï¼</p>
            <button class="btn-start" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
        </div>

        <canvas id="gameCanvas" width="800" height="400"></canvas>
    </div>

    <script src="assets/js/theme.js"></script>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const menu = document.getElementById('menu');
        const scoreEl = document.getElementById('score');

        // æ¸¸æˆå˜é‡
        let gameRunning = false;
        let score = 0;
        let frameCount = 0;
        let speed = 5;

        // ğŸ• ä¸»è§’ï¼šæœºå™¨ç‹—
        const dog = {
            x: 50,
            y: 300,
            width: 40,
            height: 40,
            dy: 0,
            jumpPower: -12,
            gravity: 0.6,
            ground: 300,
            color: '#FF7F50'
        };

        // ğŸŒµ éšœç¢ç‰©æ•°ç»„
        let obstacles = [];

        function startGame() {
            gameRunning = true;
            score = 0;
            speed = 5;
            obstacles = [];
            dog.y = dog.ground;
            menu.style.display = 'none';
            scoreEl.innerText = '0';
            animate();
        }

        function animate() {
            if (!gameRunning) return;

            requestAnimationFrame(animate);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            frameCount++;

            // 1. æ›´æ–°ç‹—ç‹—ç‰©ç†
            dog.dy += dog.gravity;
            dog.y += dog.dy;

            // åœ°é¢ç¢°æ’æ£€æµ‹
            if (dog.y > dog.ground) {
                dog.y = dog.ground;
                dog.dy = 0;
            }

            // ç”»ç‹—ç‹— (ç®€å•çš„æ–¹å—ä»£æ›¿ï¼Œä»¥åä½ å¯ä»¥æ¢æˆå›¾ç‰‡)
            ctx.fillStyle = dog.color;
            ctx.fillRect(dog.x, dog.y, dog.width, dog.height);
            // ç”»ä¸ªçœ¼ç›ï¼Œè®©å®ƒåƒåªç‹—
            ctx.fillStyle = 'white';
            ctx.fillRect(dog.x + 25, dog.y + 5, 10, 10);

            // 2. ç”Ÿæˆéšœç¢ç‰© (æ¯ 100 å¸§ç”Ÿæˆä¸€ä¸ª)
            if (frameCount % 100 === 0) {
                let height = Math.random() * 40 + 20; // éšæœºé«˜åº¦
                obstacles.push({
                    x: canvas.width,
                    y: 340 - height,
                    width: 30,
                    height: height + 40, // è¿™é‡Œçš„é€»è¾‘æ˜¯ä¸ºäº†è´´åœ°
                    color: '#9370DB'
                });
                
                // éšç€æ—¶é—´åŠ é€Ÿ
                if (score % 5 === 0) speed += 0.1;
            }

            // 3. æ›´æ–°éšœç¢ç‰©
            for (let i = 0; i < obstacles.length; i++) {
                let obs = obstacles[i];
                obs.x -= speed;

                // ç”»éšœç¢ç‰©
                ctx.fillStyle = obs.color;
                ctx.fillRect(obs.x, 340 - obs.height + 40, obs.width, obs.height); // ä¿®æ­£åæ ‡

                // è®¡åˆ†ï¼šå¦‚æœä½ è·³è¿‡äº†å®ƒ
                if (obs.x + obs.width < dog.x && !obs.passed) {
                    score++;
                    scoreEl.innerText = score;
                    obs.passed = true;
                }

                // ç§»é™¤å±å¹•å¤–çš„
                if (obs.x < -50) {
                    obstacles.splice(i, 1);
                    i--;
                }

                // ğŸ”¥ ç¢°æ’æ£€æµ‹ (ç®€å•çš„çŸ©å½¢ç¢°æ’)
                if (
                    dog.x < obs.x + obs.width &&
                    dog.x + dog.width > obs.x &&
                    dog.y < (340 - obs.height + 40) + obs.height &&
                    dog.y + dog.height > (340 - obs.height + 40)
                ) {
                    gameOver();
                }
            }

            // ç”»åœ°é¢çº¿
            ctx.beginPath();
            ctx.moveTo(0, 340);
            ctx.lineTo(800, 340);
            ctx.strokeStyle = '#333';
            ctx.stroke();
        }

        function jump() {
            if (dog.y === dog.ground && gameRunning) {
                dog.dy = dog.jumpPower;
            }
        }

        function gameOver() {
            gameRunning = false;
            menu.style.display = 'flex';
            menu.innerHTML = `
                <h1>ğŸ’¥ æ’è½¦å•¦!</h1>
                <p>ä½ çš„å¾—åˆ†: <b>${score}</b></p>
                <button class="btn-start" onclick="startGame()">å†è¯•ä¸€æ¬¡</button>
            `;
        }

        // æ“ä½œç›‘å¬
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') jump();
        });
        document.addEventListener('touchstart', jump);
        canvas.addEventListener('click', jump);

    </script>
</body>
</html>